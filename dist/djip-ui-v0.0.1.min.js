import EventEmitter from"../libs/eventemitter3.js";const DEFAULT_CLASS="djipui";export class Item extends EventEmitter{constructor(e={},t={}){super(),this._domElement=null,this._parent=null,this._callbacks={},this.data=new Proxy(t,{set:(e,t,n)=>(e[t]=n,this._update(t),!0)}),e.id&&(this.id=e.id),e.parent&&(this.parent=e.parent),this.injectStylesInHead(`styles-${DEFAULT_CLASS}-${this.type.toLowerCase()}`,this.css)}_update(e){}get domElement(){return this._domElement||(this._domElement=(new DOMParser).parseFromString(this.template,"text/html").body.firstChild),this._domElement}get content(){return this.domElement.querySelector("div.content")}get template(){return`<div class="${DEFAULT_CLASS} item"></div>`}get css(){return""}get parent(){return this._parent}set parent(e){this.parent&&this.parent.content&&(this.parent.content.removeChild(this.domElement),this._parent=null),e&&e.content&&"function"==typeof e.content.appendChild&&(e.content.appendChild(this.domElement),this._parent=e)}get type(){return this.constructor.name}get id(){return this.domElement.id}set id(e){this.domElement.setAttribute("id",e.toString())}injectStylesInHead(e,t=""){if(e.length<1)throw new TypeError("The 'id' parameter must be a string.");let n=document.getElementById(e);n&&document.head.removeChild(n),t.length>0&&((n=document.createElement("style")).type="text/css",n.setAttribute("id",e),n.appendChild(document.createTextNode(t)),document.head.appendChild(n))}destroy(){this.parent&&this.parent.content.removeChild(this.domElement),this.removeAllListeners()}}export class Container extends Item{constructor(e={},t={}){super(e),this.children=e.children||[],this.children.forEach(e=>this.addChild(e.type,e.options,e.data))}get template(){return`\n      <div class="${DEFAULT_CLASS} item container">\n        <div class="content"></div>\n      </div>\n    `}get css(){return"\n      .djipui.container > .content:empty {\n        display: none;\n      }\n    \n    "}addChild(e,t={},n={}){t.parent=this;let r=new CLASSES[e](t,n);return this.children.push(r),r}getChildById(e){return this.children.forEach(t=>{if(t.id===e)return t}),!1}getDescendantById(e){if(this.id===e)return this;if(!Array.isArray(this.children))return!1;for(let t=0;t<this.children.length;t+=1){if("function"!=typeof this.children[t].getDescendantById){if(this.children[t].id===e)return this.children[t];continue}let n=this.children[t].getDescendantById(e);if(n)return n}return!1}}export class Tile extends Container{constructor(e={},t={}){super(e,t),e.label&&(this.label=e.label)}get template(){return`\n      <div class="${DEFAULT_CLASS} item container tile">\n        <h1 class="label"></h1>\n        <div class="content"></div>\n      </div>\n    `}get css(){return"\n      \n      .djipui.tile {\n        border-radius: 4px;\n        overflow: hidden;\n        margin-bottom: 0.5em;\n        width: calc(1/5*100% - (1 - 1/5)*0.5em);\n      }\n      \n      .djipui.tile:last-child {\n        margin-right: 0;\n      }\n      \n      .djipui.tile > h1 {\n        font-size: 1em;\n        font-weight: bold;\n        margin: 0;\n        background-color: rgba(0, 0, 0, .2);\n        padding: 0.25em 0.3em;\n        text-transform: uppercase;\n        min-width: 100px;\n        text-align: center;\n      }\n      \n      .djipui.tile > .content {\n    \n        display: flex;\n        flex-wrap: wrap;\n        border-bottom: 1px solid rgba(0, 0, 0, .2);\n        border-right: 1px solid rgba(0, 0, 0, .2);\n        border-left: 1px solid rgba(0, 0, 0, .2);\n        \n        padding: 0.5em;\n    \n      }\n      \n      .djipui.tile > .content:empty {\n        padding: 0;\n        border: none;\n      }\n\n    "}get label(){return this.domElement.querySelector("h1").innerHTML}set label(e){this.domElement.querySelector("h1").innerHTML=e.toString()}}export class UI extends Container{constructor(e={}){super(e),e.parentNode&&e.parentNode.appendChild?e.parentNode.appendChild(this.domElement):document.body.appendChild(this.domElement)}get template(){return`\n      <div class="${DEFAULT_CLASS} item container ui">\n        <div class="content"></div>\n      </div>\n    `}get css(){return`\n    \n      .${DEFAULT_CLASS} {\n        box-sizing: border-box;\n        font-size: 12px;\n        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n        color: rgba(255, 255, 255, 0.9)\n      }\n\n    `}set parent(e){throw new ReferenceError("The 'parent' property cannot be used on top-level objects.")}destroy(){super.destroy(),this.domElement.parentNode.removeChild(this.domElement)}}export class Value extends Item{constructor(e={},t={}){super(e,t),e.label&&(this.label=e.label)}get template(){return`\n      <div class="${DEFAULT_CLASS} item value">\n        <h1 class="label">Label</h1>\n        <div class="content">${this.data.value.toString()}</div>\n      </div>\n    `}get label(){return this.domElement.querySelector("h1").innerHTML}set label(e){this.domElement.querySelector("h1").innerHTML=e}get css(){return`\n    \n      .${DEFAULT_CLASS}.value {\n        margin-bottom: 0.5em;\n        display: flex;\n        justify-content: space-between;\n        flex-grow: 1;\n        width: 100%;\n      }\n      \n      .${DEFAULT_CLASS}.value:first-child {\n        padding-top: 0;\n      }\n      \n      .${DEFAULT_CLASS}.value:last-child {\n        border-bottom: none;\n        margin-bottom: 0;\n      }\n      \n      .${DEFAULT_CLASS}.value > h1 {\n        font-size: 1em;\n        font-weight: normal;\n        padding: 0.3em 0.5em 0.2em 0;\n        margin: 0;\n        width: 30%;\n      }\n      \n      .${DEFAULT_CLASS}.value > .content {\n        width: 70%;\n        background-color: rgba(0, 0, 0, .2);\n        padding: 0.3em 0.2em 0.2em 0.4em;\n        border-radius: 0.25em;\n      }\n      \n    `}_update(e){let t=this.data[e];"label"===e?this.domElement.querySelector("h1.label").innerHTML=t.toString():"value"===e&&(this.content.innerHTML=t.toString())}}export class Button extends Item{constructor(e={},t={}){super(e,t),e.label&&(this.label=e.label),this._callbacks.click=(e=>this.emit("click",e)),this.domElement.querySelector(".content > button").addEventListener("click",this._callbacks.click)}get template(){return`\n      <div class="${DEFAULT_CLASS} item button">\n        <div class="content">\n          <button>Button</button>\n        </div>\n      </div>\n    `}get css(){return`\n    \n      .${DEFAULT_CLASS}.button {\n        width: 100%;\n        margin-bottom: 0.5em;\n      }\n      \n      .${DEFAULT_CLASS}.button:last-child {\n        margin-bottom: 0;\n      }\n      \n      .${DEFAULT_CLASS}.button .content {\n        width: 100%;\n        display: flex;\n      }\n    \n      .${DEFAULT_CLASS}.button .content > button {\n        padding: 4px 2px;\n        background-color: rgba(0, 0, 0, .2);\n        border: 1px solid rgba(255, 226, 12, .5);\n        border-radius: 4px;\n        flex-grow: 1;\n        color: rgba(255, 255, 255, 0.9);\n        outline: none;\n      }\n      \n      .${DEFAULT_CLASS}.button .content > button:hover {\n        background-color: rgba(0, 0, 0, .3);\n      }\n  \n      .${DEFAULT_CLASS}.button .content > button:active {\n        background-color: rgba(0, 0, 0, .2);\n      }\n    \n    `}get label(){return this.domElement.querySelector(".content > button").innerHTML}set label(e){this.domElement.querySelector(".content > button").innerHTML=e.toString()}destroy(){this.domElement.querySelector(".content > button").removeEventListener("click",this._callbacks.click)}}export class Panel extends Container{constructor(e={},t={}){super(e,t),this.draggable=!0===e.draggable||!1,e.label&&(this.label=e.label)}get template(){return`\n      <div draggable="false" class="${DEFAULT_CLASS} item container panel">\n        <h1 class="label">Panel</h1>\n        <div class="content"></div>\n      </div>\n    `}get css(){return"\n    \n      .djipui.panel {\n        background-color: rgba(0, 0, 0, 0.5);\n        overflow: scroll;\n        border-radius: 0.25em;\n        margin-bottom: 0.5em;\n      }\n\n      .djipui.panel:last-child {\n        margin-bottom: 0;\n      }\n\n      .djipui.panel > h1 {\n        font-size: 1em;\n        background-color: rgba(0, 0, 0, 0.5);\n        padding: 5px 6px 5px 6px;\n        margin: 0;\n        text-transform: uppercase;\n        font-weight: bold;\n      }\n            \n      .djipui.panel[draggable=true] > h1 {\n        cursor: move;\n      }\n      \n      .djipui.panel > .content {\n        display: flex;\n        padding: 5px 6px 5px 6px;\n        flex-wrap: wrap;\n        justify-content: space-between;\n      }\n      \n      .djipui.panel > .content:empty {\n        padding: 0;\n      }\n      \n\n      \n  "}get label(){return this.domElement.querySelector("h1").innerHTML}set label(e){this.domElement.querySelector("h1").innerHTML=e.toString()}get draggable(){return this.domElement.getAttribute("draggable")}set draggable(e){this.domElement.setAttribute("draggable",!0===e)}_update(e){let t=this.data[e];"label"===e&&(this.domElement.querySelector("h1.label").innerHTML=t.toString())}_makeDraggable(e,t){let n=document.getElementsByTagName("*"),r=0;for(let e=0;e<n.length-1;e++)parseInt(n[e].style.zIndex)>r&&(r=parseInt(n[e].style.zIndex));e.addEventListener("mousedown",e=>{e.preventDefault();let n=this.container.offsetLeft,r=this.container.offsetTop,i=e.clientX,l=e.clientY,o=e=>{t.style.left=n+e.clientX-i+"px",t.style.top=r+e.clientY-l+"px"};addEventListener("mousemove",o),addEventListener("mouseup",()=>removeEventListener("mousemove",o))})}_makeCollapsible(e){this.collapsible&&e.addEventListener("dblclick",()=>this.toggleCollapse())}toggleCollapse(){if(!this.collapsible)return;let e=this.domElement.querySelector(".content");"none"===e.style.display?e.style.display="block":(e.style.height="",e.style.display="none")}}const CLASSES={Button:Button,Container:Container,Item:Item,Panel:Panel,Tile:Tile,UI:UI,Value:Value};