import EventEmitter from"./eventemitter.js";const DEFAULT_CLASS="djipui";export class Item extends EventEmitter{constructor(e={}){super(),this._domElement=null,this._parent=null,this._callbacks={},e.id&&(this.id=e.id),e.parent&&(this.parent=e.parent),this.injectStylesInHead(`styles-${DEFAULT_CLASS}-${this.type.toLowerCase()}`,this.css)}get domElement(){return this._domElement||(this._domElement=(new DOMParser).parseFromString(this.template,"text/html").body.firstChild),this._domElement}get content(){return this.domElement.querySelector("div.content")}get template(){return`<div class="${DEFAULT_CLASS} item"></div>`}get css(){return""}get parent(){return this._parent}set parent(e){this.parent&&this.parent.content&&(this.parent.content.removeChild(this.domElement),this._parent=null),e&&e.content&&"function"==typeof e.content.appendChild&&(e.content.appendChild(this.domElement),this._parent=e)}get type(){return this.constructor.name}get id(){return this.domElement.id}set id(e){this.domElement.setAttribute("id",e.toString())}injectStylesInHead(e,t=""){if(e.length<1)throw new TypeError("The 'id' parameter must be a string.");let n=document.getElementById(e);n&&document.head.removeChild(n),t.length>0&&((n=document.createElement("style")).type="text/css",n.setAttribute("id",e),n.appendChild(document.createTextNode(t)),document.head.appendChild(n))}destroy(){console.log(this),this.parent&&this.parent.content.removeChild(this.domElement),this.removeAllListeners()}}export class Container extends Item{constructor(e={}){super(e),this.children=[],(e.children||[]).forEach(e=>this.addChild(e.type,e.options))}get template(){return`\n      <div class="${DEFAULT_CLASS} item container">\n        <div class="content"></div>\n      </div>\n    `}get css(){return"\n      .djipui.container > .content:empty {\n        display: none;\n      }\n    \n    "}addChild(e,t={}){console.log("addChild",e,t),t.parent=this,console.log("children avant",e,this.children);let n=new CLASSES[e](t);return this.children.push(n),console.log("children aprÃ¨s",e,this.children),n}getChildById(e){return this.children.filter(t=>t.id===e)[0]||!1}getDescendantById(e){if(this.id===e)return this;for(let t=0;t<this.children.length;t+=1){if("function"!=typeof this.children[t].getDescendantById){if(this.children[t].id===e)return this.children[t];continue}let n=this.children[t].getDescendantById(e);if(n)return n}return!1}destroy(){super.destroy(),this.children.forEach(e=>{console.log("allo",e),e.destroy()})}}export class Tile extends Container{constructor(e={}){super(e),e.label&&(this.label=e.label)}get template(){return`\n      <div class="${DEFAULT_CLASS} item container tile">\n        <h1 class="label"></h1>\n        <div class="content"></div>\n      </div>\n    `}get css(){return"\n      \n      .djipui.tile {\n        border-radius: 4px;\n        overflow: hidden;\n        margin-bottom: 0.5em;\n        width: calc(1/4*100% - (1 - 1/4)*0.5em);\n      }\n      \n      .djipui.tile:last-child {\n        margin-right: 0;\n      }\n      \n      .djipui.tile > h1 {\n        font-size: 1em;\n        font-weight: bold;\n        margin: 0;\n        background-color: rgba(0, 0, 0, .2);\n        padding: 0.25em 0.3em;\n        text-transform: uppercase;\n        min-width: 100px;\n        text-align: center;\n      }\n      \n      .djipui.tile > .content {\n    \n        display: flex;\n        flex-wrap: wrap;\n        border-bottom: 1px solid rgba(0, 0, 0, .2);\n        border-right: 1px solid rgba(0, 0, 0, .2);\n        border-left: 1px solid rgba(0, 0, 0, .2);\n        \n        padding: 0.5em;\n    \n      }\n      \n      .djipui.tile > .content:empty {\n        padding: 0;\n        border: none;\n      }\n\n    "}get label(){return this.domElement.querySelector("h1").innerHTML}set label(e){this.domElement.querySelector("h1").innerHTML=e.toString()}}export class UI extends Container{constructor(e={}){super(e),e.parentNode&&e.parentNode.appendChild?e.parentNode.appendChild(this.domElement):document.body.appendChild(this.domElement)}get template(){return`\n      <div class="${DEFAULT_CLASS} item container ui">\n        <div class="content"></div>\n      </div>\n    `}get css(){return`\n    \n      .${DEFAULT_CLASS} {\n        box-sizing: border-box;\n        font-size: 12px;\n        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n        color: rgba(255, 255, 255, 0.9)\n      }\n\n    `}set parent(e){throw new ReferenceError("The 'parent' property cannot be used on top-level objects.")}destroy(){super.destroy(),this.domElement.parentNode.removeChild(this.domElement)}}export class Value extends Item{constructor(e={}){super(e),e.label&&(this.label=e.label),e.value&&(this.value=e.value)}get template(){return`\n      <div class="${DEFAULT_CLASS} item value">\n        <h1 class="label">Label</h1>\n        <div class="content"></div>\n      </div>\n    `}get label(){return this.domElement.querySelector("h1").innerHTML}set label(e){this.domElement.querySelector("h1").innerHTML=e}get value(){return this.domElement.querySelector("div.content").innerHTML}set value(e){this.domElement.querySelector("div.content").innerHTML=e.toString()}get css(){return`\n    \n      .${DEFAULT_CLASS}.value {\n        margin-bottom: 0.5em;\n        display: flex;\n        justify-content: space-between;\n        flex-grow: 1;\n        width: 100%;\n      }\n      \n      .${DEFAULT_CLASS}.value:first-child {\n        padding-top: 0;\n      }\n      \n      .${DEFAULT_CLASS}.value:last-child {\n        border-bottom: none;\n        margin-bottom: 0;\n      }\n      \n      .${DEFAULT_CLASS}.value > h1 {\n        font-size: 1em;\n        font-weight: normal;\n        padding: 0.3em 0.5em 0.2em 0;\n        margin: 0;\n        width: 30%;\n      }\n      \n      .${DEFAULT_CLASS}.value > .content {\n        width: 70%;\n        background-color: rgba(0, 0, 0, .2);\n        padding: 0.3em 0.2em 0.2em 0.4em;\n        border-radius: 0.25em;\n      }\n      \n    `}}export class Button extends Item{constructor(e={}){super(e),e.label&&(this.label=e.label),this._callbacks.click=(e=>this.emit("click",e)),this.domElement.querySelector(".content > button").addEventListener("click",this._callbacks.click)}get template(){return`\n      <div class="${DEFAULT_CLASS} item button">\n        <div class="content">\n          <button>Button</button>\n        </div>\n      </div>\n    `}get css(){return`\n    \n      .${DEFAULT_CLASS}.button {\n        width: 100%;\n        margin-bottom: 0.5em;\n      }\n      \n      .${DEFAULT_CLASS}.button:last-child {\n        margin-bottom: 0;\n      }\n      \n      .${DEFAULT_CLASS}.button .content {\n        width: 100%;\n        display: flex;\n      }\n    \n      .${DEFAULT_CLASS}.button .content > button {\n        padding: 4px 2px;\n        background-color: rgba(0, 0, 0, .2);\n        border: 1px solid rgba(255, 226, 12, .5);\n        border-radius: 4px;\n        flex-grow: 1;\n        color: rgba(255, 255, 255, 0.9);\n        outline: none;\n      }\n      \n      .${DEFAULT_CLASS}.button .content > button:hover {\n        background-color: rgba(0, 0, 0, .3);\n      }\n  \n      .${DEFAULT_CLASS}.button .content > button:active {\n        background-color: rgba(0, 0, 0, .2);\n      }\n    \n    `}get label(){return this.domElement.querySelector(".content > button").innerHTML}set label(e){this.domElement.querySelector(".content > button").innerHTML=e.toString()}destroy(){this.domElement.querySelector(".content > button").removeEventListener("click",this._callbacks.click),this.removeAllListeners()}}export class Panel extends Container{constructor(e={}){super(e),this.draggable=!0===e.draggable||!1,e.label&&(this.label=e.label)}get template(){return`\n      <div draggable="false" class="${DEFAULT_CLASS} item container panel">\n        <h1 class="label">Panel</h1>\n        <div class="content"></div>\n      </div>\n    `}get css(){return"\n    \n      .djipui.panel {\n        background-color: rgba(0, 0, 0, 0.5);\n        overflow: scroll;\n        border-radius: 0.25em;\n        margin-bottom: 0.5em;\n      }\n\n      .djipui.panel:last-child {\n        margin-bottom: 0;\n      }\n\n      .djipui.panel > h1 {\n        font-size: 1em;\n        background-color: rgba(0, 0, 0, 0.5);\n        padding: 5px 6px 5px 6px;\n        margin: 0;\n        text-transform: uppercase;\n        font-weight: bold;\n      }\n            \n      .djipui.panel[draggable=true] > h1 {\n        cursor: move;\n      }\n      \n      .djipui.panel > .content {\n        display: flex;\n        padding: 5px 6px 5px 6px;\n        flex-wrap: wrap;\n        justify-content: space-between;\n      }\n      \n      .djipui.panel > .content:empty {\n        padding: 0;\n      }\n      \n\n      \n  "}get label(){return this.domElement.querySelector("h1").innerHTML}set label(e){this.domElement.querySelector("h1").innerHTML=e.toString()}get draggable(){return this.domElement.getAttribute("draggable")}set draggable(e){this.domElement.setAttribute("draggable",!0===e)}_makeDraggable(e,t){let n=document.getElementsByTagName("*"),r=0;for(let e=0;e<n.length-1;e++)parseInt(n[e].style.zIndex)>r&&(r=parseInt(n[e].style.zIndex));e.addEventListener("mousedown",e=>{e.preventDefault();let n=this.container.offsetLeft,r=this.container.offsetTop,i=e.clientX,l=e.clientY,s=e=>{t.style.left=n+e.clientX-i+"px",t.style.top=r+e.clientY-l+"px"};addEventListener("mousemove",s),addEventListener("mouseup",()=>removeEventListener("mousemove",s))})}_makeCollapsible(e){this.collapsible&&e.addEventListener("dblclick",()=>this.toggleCollapse())}toggleCollapse(){if(!this.collapsible)return;let e=this.domElement.querySelector(".content");"none"===e.style.display?e.style.display="block":(e.style.height="",e.style.display="none")}}const CLASSES={Button:Button,Container:Container,Item:Item,Panel:Panel,Tile:Tile,UI:UI,Value:Value};class Listener{constructor(e,t,n=!1){this.fn=e,this.context=t,this.once=!0===n||!1}}export default class EventEmitter{constructor(){this._events={},this._eventsCount=0}addListener(e,t,n,r=!1){if("function"!=typeof t)throw new TypeError("The listener must be a function");let i=new Listener(t,n||this,r);return this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],i]:this._events[e].push(i):(this._events[e]=i,this._eventsCount++),this}clearEvent(e){0==--this._eventsCount?this._events={}:delete this._events[e]}get eventNames(){let e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n}getListeners(e){let t=[],n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(let e=0;e<n.length;e++)t[e]=n[e].fn;return t}getListenerCount(e){let t=this._events[e];return t?t.fn?1:t.length:0}emit(e,t,n,r,i,l){if(!this._events[e])return!1;let s,o,a=this._events[e],d=arguments.length;if(a.fn){switch(a.once&&this.removeListener(e,a.fn,void 0,!0),d){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,t),!0;case 3:return a.fn.call(a.context,t,n),!0;case 4:return a.fn.call(a.context,t,n,r),!0;case 5:return a.fn.call(a.context,t,n,r,i),!0;case 6:return a.fn.call(a.context,t,n,r,i,l),!0}for(o=1,s=new Array(d-1);o<d;o++)s[o-1]=arguments[o];a.fn.apply(a.context,s)}else{let i,l=a.length;for(o=0;o<l;o++)switch(a[o].once&&this.removeListener(e,a[o].fn,void 0,!0),d){case 1:a[o].fn.call(a[o].context);break;case 2:a[o].fn.call(a[o].context,t);break;case 3:a[o].fn.call(a[o].context,t,n);break;case 4:a[o].fn.call(a[o].context,t,n,r);break;default:if(!s)for(i=1,s=new Array(d-1);i<d;i++)s[i-1]=arguments[i];a[o].fn.apply(a[o].context,s)}}return!0}on(e,t,n){return this.addListener(e,t,n,!1)}once(e,t,n){return this.addListener(e,t,n,!0)}removeListener(e,t,n,r){let i=[];if(!this._events[e])return this;if(!t)return this.clearEvent(e),this;let l=this._events[e];if(l.fn)l.fn!==t||r&&!l.once||n&&l.context!==n||this.clearEvent(e);else{for(let e=0,i=[],s=l.length;e<s;e++)(l[e].fn!==t||r&&!l[e].once||n&&l[e].context!==n)&&i.push(l[e]);i.length?this._events[e]=1===i.length?i[0]:i:this.clearEvent(e)}return this}removeAllListeners(e){return e?this._events[e]&&this.clearEvent(e):(this._events={},this._eventsCount=0),this}}